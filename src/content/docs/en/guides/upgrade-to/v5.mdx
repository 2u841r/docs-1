---
title: Astro v5.0-beta
description: Documentation for Astro v5.0-beta projects
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import { Steps } from '@astrojs/starlight/components';

{/* This guide will help you migrate from Astro v3 to Astro v4.

Need to upgrade an older project to v3? See our [older migration guide](/en/guides/upgrade-to/v3/).

Need to see the v3 docs? Visit this [older version of the docs site (unmaintained v3.6 snapshot)](https://docs-git-v3-docs-unmaintained-astrodotbuild.vercel.app/). */}

This page provides extra documentation for Astro v5.0 beta testers. 

This page will help you:

- [Upgrade](#upgrade-astro) to the beta version.
- Address any [breaking changes](#breaking-changes) that might affect your project.
- Learn about the new features available in this major version.

:::caution[For beta testers only]
The changes and features on this page may **conflict with the rest of the documentation**.

Astro's documentation always reflects the current, **stable** version. The guidance on this page is provided to help you test v5.0-beta, which may differ from the latest published version.
:::

## Upgrade Astro

{/* Update your project's version of Astro and all official integrations to the latest versions using your package manager.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # Upgrade Astro and official integrations together
  npx @astrojs/upgrade
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # Upgrade Astro and official integrations together
  pnpm dlx @astrojs/upgrade
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # Upgrade Astro and official integrations together
  yarn dlx @astrojs/upgrade
  ```
  </Fragment>
</PackageManagerTabs>

You can also [upgrade your Astro integrations manually](/en/guides/integrations-guide/#manual-upgrading) if needed, and you may also need to upgrade other dependencies in your project. */}

Update your project's version of Astro to the latest beta version using your package manager:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # Upgrade Astro and official integrations together
  npx @astrojs/upgrade 
  //NEED A V5 SPECIFIC COMMAND, AND NOW TO KNOW THE LATEST
  // HOW TO UPGRADE INTEGRATIONS w BETA?
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # Upgrade Astro and official integrations together
  pnpm dlx @astrojs/upgrade 
  //NEED A V5 SPECIFIC COMMAND, AND NOW TO KNOW THE LATEST
  // HOW TO UPGRADE INTEGRATIONS w BETA?
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # Upgrade Astro and official integrations together
  yarn dlx @astrojs/upgrade 
  //NEED A V5 SPECIFIC COMMAND, AND NOW TO KNOW THE LATEST
  // HOW TO UPGRADE INTEGRATIONS w BETA?
  ```
  </Fragment>
</PackageManagerTabs>

You can also [upgrade your Astro integrations manually](/en/guides/integrations-guide/#manual-upgrading) if needed, and you may also need to upgrade other dependencies in your project.

:::note[Need to continue?]
After upgrading Astro, you may not need to make any changes to your project at all!

But, if you notice errors or unexpected behavior, please check below for what has changed that might need updating in your project.
:::

Astro v5.0 includes [potentially breaking changes](#breaking-changes), as well as the [removal of some previously deprecated features](#previously-deprecated-features-now-removed). 

If your project doesn't work as expected after upgrading to v5.0, check this guide for an overview of all breaking changes and instructions on how to update your codebase.

See [the changelog](https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md) for full release notes. 

// WILL THE CHANGELOG SHOW BETA RELEASE NOTES?? IF NOT WHERE SPECIFICALLY TO LOOK?

## Astro v5.0 Experimental Flags Removed

The following features are no longer experimental in Astro v5.0: `actions`, `directRenderScript`, `globalRoutePriority`, `rewrites`, `env`, `serverIslands`.

Remove their experimental flags if you were previously using them, and move your `env` configuration to the root of your Astro config:

```js del={5-12} ins={14-16} title="astro.config.mjs"
import { defineConfig } from 'astro/config';

export default defineConfig({
  experimental: {
    actions: true,
    directRenderScript: true,
    globalRoutePriority: true,
    rewrites: true,
    serverIslands: true,
    env: {
      schema: {...}
    }
  },
  env: {
      schema: {...}
  }
})
```

These features are all available by default in Astro v5.0. Only `astro:env` requires any configuration to use.

Read about these exciting features and more in [the v5.0-beta Blog post](https://astro.build/blog/astro-4/). 

:::note
These features are still experimental in the current stable version of Astro. You can continue to find their official documentation in the [Experimental flags section](/en/reference/configuration-reference/#experimental-flags) of the configuration reference page.
:::

## Upgrades

// THESE ARE FOR DEPENDENCY UPGRADES

Any major upgrades to Astro's dependencies may cause breaking changes in your project.

### Upgraded: Vite 5.0

Placeholder

#### What should I do?

If you are using Vite-specific plugins, configuration, or APIs, check the [Vite migration guide](https://vitejs.dev/guide/migration) for their breaking changes and upgrade your project as needed. There are no breaking changes to Astro itself.

### Upgraded: minimum Node version

Placeholder (ensures compatibility with Sharp)

#### What should I do?

 Check that both your development environment and your deployment environment are using **Node `x.x.x` or higher**.

<Steps>
1. Check your local version of Node using:

    ```sh
    node -v
    ```

2. Check your [deployment environment's](/en/guides/deploy/) own documentation to verify that they support Node xx.

    You can specify Node `x.x.x` for your Astro project either in a dashboard configuration setting or a `.nvmrc` file.

    ```bash title=".nvmrc"
    x.x.x
    ```
</Steps>

## Breaking Changes

The following changes are considered breaking changes in Astro v5.0. Breaking changes may or may not provide temporary backwards compatibility.

:::note

**These 5.0-beta changes conflict with the rest of Astro's documentation.**

The following content is **not**  consistent with the rest of Astro Docs. The main docs will be updated for the v5.0 **stable** release only.
:::
 
{/* If you need to refer to the documentation for a v4.x project, you can browse this [(unmaintained) snapshot of the docs from before v4.0 was released](https://docs-git-v3-docs-unmaintained-astrodotbuild.vercel.app/). */}

### Removed: some public-facing types (core)

In Astro v4.x, `@types/astro.ts` exposed all types publicly to users, whether or not they were still actively used or only intended for internal use.

Astro v5.0 refactors this file to [remove outdated and internal types (link to PR for all the messy details if it's too long to list here)](). This refactor brings improvements to your editor (faster completions, lower memory use, more relevant completion options). However, this refactor may cause errors in some projects that have been relying on types that are no longer available to the public.

#### What should I do?

Remove any types that now cause errors in your project. You no longer have access to these.

### Changed: CSRF protection is now set by default (core)

In Astro v4.0, The default value of `security.checkOrigin` was `false`. Previously, you had to explicitly set this value to `true` to enable Cross-Site Request Forgery (CSRF) protection.

Astro v5.0 changes the default value  of this option to `true`, and will automatically check that the "origin" header matches the URL sent by each request in on-demand rendered pages.

#### What should I do?

If you had previously configured `security.checkOrigin: true`, you no longer need this line in your Astro config. This is now the default.

To disable this behaviour, you must explicitly set  `security.checkOrigin: false`.

```js title="astro.config.mjs" del={3-5}
export default defineConfig({
  output: "server",
  security: {
    checkOrigin: true
  }
})
```

### Changed: (PLT2255)

Enable prefetch by default

#### What should I do?

Stuff!

### Changed: (PLT2220)

Rethink `--mode` and internal mode usage

#### What should I do?

Stuff!

### Changed: (PLT2204)

Add base to `paginate`

#### What should I do?

Stuff!

### Changed: (PLT2214)

COnsider renaming the CLI command `sync`

#### What should I do?

Stuff!

### Changed: (PLT1057)

Decide if charset=utf-8 should not be set for md/mdx pages by default

#### What should I do?

Stuff!

### Changed: (PLT2118)

Prevent use of `astro:content` on the client

#### What should I do?

Stuff!

### Changed: (PLT1776)

Revisit configuration passed to integrations

#### What should I do?

Stuff!

### Changed: (PLT1631)

To consider - set `ssr.external: true` when using Vite to load configs

#### What should I do?

Stuff!

### Changed: (PLT1548)

COnsider supporting `type="module"` for people who want to set it explicitly

#### What should I do?

Stuff!


### Changed: (PLT1323)

Revisit top level await in `vite-plugin-markdown`'s `astro:assets` support

#### What should I do?

Stuff!

### Removed: (PLT1380)

Remove the Squoosh image service from AStro's built-in services

#### What should I do?

Stuff!

### Removed: (PLT1751)

Remove `allowJs: false` from our strictest preset

#### What should I do?

Stuff!

## Deprecated

The following deprecated features are no longer supported and are no longer documented. Please update your project accordingly.

Some deprecated features may temporarily continue to function until they are completely removed. Others may silently have no effect, or throw an error prompting you to update your code.

### Deprecated: `functionPerRoute` (Adapter API)

In Astro v4.x, you could opt in to creating a separate file for each route defined in the project, mirroring your `src/pages/` directory in the build folder. By default, Astro emitted a single `entry.mjs` file, which was responsible for emitting the rendered page on each request.

Astro v5.0 removes the option to opt out of the default behavior. This behavior is now standard, and non-configurable.


#### What should I do?

Remove the `functionPerRoute` property from your `adapterFeatures` configuration. It is no longer available.

```js title="my-adapter.mjs" del={10}
export default function createIntegration() {
  return {
    name: '@matthewp/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@matthewp/my-adapter',
          serverEntrypoint: '@matthewp/my-adapter/server.js',
          adapterFeatures: {
              functionPerRoute: true
          }
        });
      },
    },
  };
}

```

### Deprecated: `build.format=file` (core)

In Astro v4.x, 

Astro v5.0 removes the option 


#### What should I do?

Choose a different value

### Deprecated: The Lit integration (integrations)

In Astro v4.x, 

Astro v5.0 removes the integration 


#### What should I do?

Choose a different value

### Deprecated: `define:vars` (core)

In Astro v4.x, 

Astro v5.0 removes the directive 


#### What should I do?

Choose a different value

## Previously deprecated features now removed

The following deprecated features have now been entirely removed from the code base and can no longer be used. Some of these features may have continued to work in your project even after deprecation. Others may have silently had no effect.

Projects now containing these removed features will be unable to build, and there will no longer be any supporting documentation prompting you to remove these features.

### Removed: returning simple objects from endpoints

In Astro v3.x, returning simple objects from endpoints was deprecated, but was still supported to maintain compatibility with Astro v2. A `ResponseWithEncoding` utility was also provided to ease the migration.

Astro v4.0 removes support for simple objects and requires endpoints to always return a `Response`. The `ResponseWithEncoding` utility is also removed in favor of a proper `Response` type.

#### What should I do?

Update your endpoints to return a `Response` object directly.

```diff lang="ts"
  export async function GET() {
-   return { body: { "title": "Bob's blog" }};
+   return new Response(JSON.stringify({ "title": "Bob's blog" }));
  }
```

To remove usage of `ResponseWithEncoding`, refactor your code to use an `ArrayBuffer` instead:

```diff lang="ts"
  export async function GET() {
    const file = await fs.readFile('./bob.png');
-   return new ResponseWithEncoding(file.toString('binary'), undefined, 'binary');
+   return new Response(file.buffer);
  }
```

### Removed: `build.split` and `build.excludeMiddleware`

In Astro v3.0, `build.split` and `build.excludeMiddleware` build config options were deprecated and replaced with [adapter configuration options](/en/reference/adapter-reference/#adapter-features) to perform the same tasks.

Astro v4.0 removes these properties entirely.

#### What should I do?

If you are using the deprecated `build.split` or `build.excludeMiddleware`, you must now remove them as these no longer exist.

Please see the v3 migration guide to [update these deprecated middleware properties](/en/guides/upgrade-to/v3/#deprecated-buildexcludemiddleware-and-buildsplit) with adapter configurations.

### Removed: `Astro.request.params`

In Astro v3.0, the `Astro.request.params` API was deprecated, but preserved for backwards compatibility.

Astro v4.0 removes this option entirely.

#### What should I do?

Update all occurrences to [`Astro.params`](/en/reference/api-reference/#astroparams), which is the supported replacement.

```astro del={1} ins={2}
const { id } = Astro.request.params;
const { id } = Astro.params;
```

### Removed: `markdown.drafts`

In Astro v3.0, using `markdown.drafts` to control the building of draft posts was deprecated.

Astro v4.0 removes this option entirely.

#### What should I do?

If you are using the deprecated `markdown.drafts`, you must now remove it as it no longer exists.

To continue to mark some pages in your project as drafts, [migrate to content collections](/en/guides/content-collections/#migrating-from-file-based-routing) and [manually filter out pages](/en/guides/content-collections/#filtering-collection-queries) with the `draft: true` frontmatter property instead.

### Removed: `getHeaders()`

In Astro v3.0, the `getHeaders()` Markdown export was deprecated and replaced with `getHeadings()`.

Astro v4.0 removes this option entirely.

#### What should I do?

If you are using the deprecated `getHeaders()`, you must now remove it as it no longer exists. Replace any instances with `getHeadings()`, which is the supported replacement.

```js del={2} ins={3}
const posts = await Astro.glob('../content/blog/*.mdx');
const firstPostHeadings = posts.at(0).getHeaders();
const firstPostHeadings = posts.at(0).getHeadings();
```

### Removed: using `rss` in `getStaticPaths()`

In Astro v3.0, using the deprecated `rss` helper in `getStaticPaths()` would throw an error.

Astro v4.0 removes this helper entirely.

#### What should I do?

If you are using the unsupported method for generating RSS feeds, you must now use the [`@astrojs/rss` integration](/en/guides/rss/) for a complete RSS setup.

### Removed: lowercase HTTP method names

In Astro v3.0, using lowercase HTTP request method names (`get`, `post`, `put`, `all`, `del`) was deprecated.

Astro v4.0 removes support for lowercase names entirely. All HTTP request methods must now be written using uppercase.

#### What should I do?

If you are using the deprecated lowercase names, you must now replace them with their uppercase equivalents.

Please see the v3 migration guide [for guidance using uppercase HTTP request methods](/en/guides/upgrade-to/v3/#changed-http-request-methods-case).

### Removed: 301 redirects when missing a `base` prefix

In Astro v3.x, the Astro preview server returned a 301 redirect when accessing public directory assets without a base path.

Astro v4.0 returns a 404 status without a base path prefix for public directory assets when the preview server is running, matching the behavior of the dev server.
 
#### What should I do?

When using the Astro preview server, all of your static asset imports and URLs from the public directory must have [the base value](/en/reference/configuration-reference/#base) prefixed to the path.

The following example shows the `src` attribute required to display an image from the public folder when `base: '/docs'` is configured:

```astro title="src/pages/index.astro" ins="/docs"
// To access public/images/my-image.png:

<img src="/docs/images/my-image.png" alt="">
```

### Removed: `astro/client-image` auto-conversion

In Astro v3.x, the `astro/client-image` type (used for the deprecated image integration) was removed but was auto-converted to the default Astro type `astro/client` if found in your `env.d.ts` file.

Astro v4.0 ignores `astro/client-image` and will no longer update `env.d.ts` for you automatically.

#### What should I do?

If you had types configured for `@astrojs/image` in `src/env.d.ts` and upgrading to v3.0 did not automatically convert the type for you, replace the `astro/client-image` type manually with `astro/client`.

```ts title="src/env.d.ts" del={1} ins={2}
  /// <reference types="astro/client-image" />
  /// <reference types="astro/client" />
```

## Community Resources

Know a good resource for Astro v4.0? [Edit this page](https://github.com/withastro/docs/edit/main/src/content/docs/en/guides/upgrade-to/v4.mdx) and add a link below!

## Known Issues

Please check [Astro's issues on GitHub](https://github.com/withastro/astro/issues/) for any reported issues, or to file an issue yourself.
